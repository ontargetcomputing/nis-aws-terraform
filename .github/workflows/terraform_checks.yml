name: Terraform Checks

on:
  workflow_run:
    workflows: 
      - "Identify Modified Workspaces"
    types:
      - completed


jobs:
  terraform-lint:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
      - name: Download Workspace Status
        uses: actions/download-artifact@v4
        with:
          name: modified_workspaces-${{ github.event.workflow_run.id }}
          
      - name: Display structure of downloaded files
        run: ls -R

      - name: Check Status
        id: check
        run: |
          cat modified_workspaces.txt
          STATUS=$(grep "status=" modified-workspaces.txt | cut -d'=' -f2)
          if [[ "$STATUS" != "single" ]]; then
            echo "Workflow skipped: Not a single workspace modification"
            exit 0
          fi
          
          WORKSPACE=$(grep "workspace=" workspace-status.txt | cut -d'=' -f2)
          echo "workspace=$WORKSPACE" >> $GITHUB_OUTPUT
          echo "aFound single workspace: $WORKSPACE"

