name: Terraform Checks

on:
  workflow_run:
    workflows: ["Check Modified Workspaces"]
    types:
      - completed

jobs:
  process-workspace:
    runs-on: ubuntu-latest
    steps:
      - name: Download Workspace Status
        uses: dawidd6/action-download-artifact@v3
        with:
          workflow: Check Modified Workspaces
          name: workspace-status
          
      - name: Check Status
        id: check
        run: |
          cat workspace-status-txt
          STATUS=$(grep "status=" workspace-status.txt | cut -d'=' -f2)
          if [[ "$STATUS" != "single" ]]; then
            echo "Workflow skipped: Not a single workspace modification"
            exit 0
          fi
          
          WORKSPACE=$(grep "workspace=" workspace-status.txt | cut -d'=' -f2)
          echo "workspace=$WORKSPACE" >> $GITHUB_OUTPUT
          echo "Found single workspace: $WORKSPACE"

